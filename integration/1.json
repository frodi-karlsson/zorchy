{
  "$schema": "../schema.json",
  "entryPoint": "make dir",
  "workflows": [
    {
      "name": "make dir",
      "task": {
        "Shell": {
          "command": "mkdir",
          "args": ["-p", "./integration/out/1"]
        }
      }
    },
    {
      "name": "make file",
      "task": {
        "Shell": {
          "command": "touch",
          "args": ["./integration/out/1/output.txt"]
        }
      },
      "dependsOn": ["make dir"]
    },
    {
      "name": "populate file",
      "task": {
        "Shell": {
          "command": "sh",
          "args": [
            "-c",
            "echo \"Hello, World!\" > ./integration/out/1/output.txt"
          ]
        }
      },
      "dependsOn": ["make file"]
    },
    {
      "name": "verify file",
      "task": {
        "Shell": {
          "command": "sh",
          "args": [
            "-c",
            "grep -q 'Hello, World!' ./integration/out/1/output.txt"
          ]
        }
      },
      "onError": "invalid file content",
      "dependsOn": ["populate file"]
    },
    {
      "name": "invalid file content",
      "task": {
        "Shell": {
          "command": "sh",
          "args": [
            "-c",
            "echo 'File content is invalid. Expected \"Hello, World!\", but got:'; cat ./integration/out/1/output.txt >&2; exit 1"
          ]
        }
      },
      "dependsOn": ["err"]
    },
    {
      "name": "echo file",
      "task": {
        "Shell": {
          "command": "head",
          "args": ["-n1", "./integration/out/1/output.txt"]
        }
      },
      "dependsOn": ["verify file"]
    },
    {
      "name": "failing test",
      "task": {
        "Shell": {
          "command": "sh",
          "args": ["-c", "exit 1"]
        }
      },
      "onError": "finish",
      "dependsOn": ["echo file"]
    },
    {
      "name": "finish",
      "task": {
        "Mock": {
          "status": "Completed"
        }
      }
    }
  ]
}
